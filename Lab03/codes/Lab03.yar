rule Lab03_01 {
   meta:
      description = " - file Lab03-01.exe"
      author = "Luhaozhhhe"
      date = "2024-10-03"
      hash1 = "eb84360ca4e33b8bb60df47ab5ce962501ef3420bc7aab90655fd507d2ffcedd"
   strings:
      $s1 = "vmx32to64.exe" fullword ascii
      $s2 = "SOFTWARE\\Classes\\http\\shell\\open\\commandU" fullword ascii
      $s3 = " www.practicalmalwareanalysis.com" fullword ascii
      $s4 = "CONNECT %s:%i HTTP/1.0" fullword ascii
      $s5 = "advpack" fullword ascii
      $s6 = "VideoDriver" fullword ascii
      $s7 = "AppData" fullword ascii
      $s8 = "advapi32" fullword ascii 
      $s9 = "ntdll" fullword ascii 
      $s10 = "WinVMX32-" fullword ascii
      $s11 = "Software\\Microsoft\\Active Setup\\Installed Components\\test" fullword ascii
      $s12 = "ws2_32" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 20KB and 8 of them
}

rule Lab03_02 {
   meta:
      description = " - file Lab03-02.dll"
      author = "Luhaozhhhe"
      date = "2024-10-03"
      hash1 = "5eced7367ed63354b4ed5c556e2363514293f614c2c2eb187273381b2ef5f0f9"
   strings:
      $s1 = "%SystemRoot%\\System32\\svchost.exe -k " fullword ascii
      $s2 = "cmd.exe /c " fullword ascii
      $s3 = "RegOpenKeyEx(%s) KEY_QUERY_VALUE error ." fullword ascii
      $s4 = "Lab03-02.dll" fullword ascii
      $s5 = "practicalmalwareanalysis.com" fullword ascii
      $s6 = "RegOpenKeyEx(%s) KEY_QUERY_VALUE success." fullword ascii
      $s7 = "GetModuleFileName() get dll path" fullword ascii
      $s8 = "dW5zdXBwb3J0" fullword ascii /* base64 encoded string 'unsupport' */
      $s9 = "Y29ubmVjdA==" fullword ascii /* base64 encoded string 'connect' */
      $s10 = "CreateService(%s) error %d" fullword ascii
      $s11 = "Internet Network Awareness" fullword ascii
      $s12 = "RegQueryValueEx(Svchost\\netsvcs)" fullword ascii
      $s13 = "netsvcs" fullword ascii
      $s14 = "serve.html" fullword ascii
      $s15 = "svchost.exe" fullword ascii
      $s16 = "IPRIP" fullword ascii
      $s17 = "uninstall is starting" fullword ascii
      $s18 = "uninstall success" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 70KB and
      6 of them
}

rule Lab03_03 {
   meta:
      description = " - file Lab03-03.exe"
      author = "Luhaozhhhe"
      date = "2024-10-03"
      hash1 = "ae8a1c7eb64c42ea2a04f97523ebf0844c27029eb040d910048b680f884b9dce"
   strings:
      $s1 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii 
      $s2 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      $s3 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      $s4 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii                                                            
      $s5 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii                                                                                          
      $s6 = "aAAAAAAAAAAAAAAAAAAAAAAA" ascii 
      $s7 = "\\svchost.exe" fullword ascii
      $s8 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii 
      $s9 = "BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii 
      $s10 = "AAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii 
      $s11 = "AAAAAABAAAAA" ascii 
      $s12 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      $s13 = "AAAqAAApAAAsAAArAAAuAAAtAAAwAAAvAAAyAAAxAAA" fullword ascii 
      $s14 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      $s15 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAq" fullword ascii 
      $s16 = "KERNEL32.dll" fullword ascii
      $s17 = "practicalmalwareanaysis.log" fullword ascii
      $s18 = "+A+A+A+A" fullword ascii 

   condition:
      uint16(0) == 0x5a4d and filesize < 200KB and
      9 of them
}

rule Lab03_04 {
   meta:
      description = " - file Lab03-04.exe"
      author = "Luhaozhhhe"
      date = "2024-10-03"
      hash1 = "6ac06dfa543dca43327d55a61d0aaed25f3c90cce791e0555e3e306d47107859"
   strings:
      $s1 = "http://www.practicalmalwareanalysis.com" fullword ascii
      $s2 = "%SYSTEMROOT%\\system32\\" fullword ascii
      $s3 = " HTTP/1.0" fullword ascii
      $s4 = " Manager Service" fullword ascii
      $s5 = "UPLOAD" fullword ascii 
      $s6 = "DOWNLOAD" fullword ascii 
      $s7 = "command.com" fullword ascii 
      $s8 = "-cc" fullword ascii 
      $s9 = "-re" fullword ascii 
      $s10 = "SOFTWARE\\Microsoft \\XPS" fullword ascii
      $s11 = "cmd.exe" fullword ascii
      $s12 = " >> NUL" fullword ascii
      $s13 = "-in" fullword ascii
      $s14 = "ShellExecuteA" fullword ascii

   condition:
      uint16(0) == 0x5a4d and filesize < 200KB and
      7 of them
}